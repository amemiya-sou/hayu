(function ($) {
    function cleanQuery(query) {
        var arr = [];
        $.each(query.split('&'), function (i, param) {
            if (param.split('=')[1]) { arr.push(param); }
        });
        return arr.join('&');
    }

    $.fn.cleanQuery = function () {
        this.on('submit', function (event) {
            event.preventDefault();

            var query = cleanQuery($(this).serialize());
            location.href = this.action + '?' + query;
        });

        return this;
    };
})(jQuery);

$(function () {
    var source = function () {
        return function (request, response) {
            var list = [];
            var list_bubun = [];
            var poke_kata = [
                "あおぞらプレート",
                "あかいいと",
                "あついいわ",
                "あつぞこブーツ",
                "あまーいりんご",
                "いかさまダイス",
                "いかずちプレート",
                "いじっぱりミント",
                "いのちのたま",
                "イワイノヨロイ",
                "インドメタシン",
                "うすもものミツ",
                "うっかりやミント",
                "エレキシード",
                "おうじゃのしるし",
                "おおきなねっこ",
                "おくびょうミント",
                "おだやかミント",
                "おっとりミント",
                "おとなしいミント",
                "おまもりこばん",
                "おんみつマント",
                "かいがらのすず",
                "かえんだま",
                "かけたポット",
                "かしらのしるし",
                "かたいいし",
                "かみなりのいし",
                "からぶりほけん",
                "かるいし",
                "かわらずのいし",
                "がんせきプレート",
                "きあいのタスキ",
                "きあいのハチマキ",
                "きせきのタネ",
                "キトサン",
                "きゅうこん",
                "きれいなぬけがら",
                "ぎんのおうかん",
                "きんのおうかん",
                "ぎんのこな",
                "きんりょくのハネ",
                "くちたけん",
                "くちたたて",
                "くっつきバリ",
                "グラスシード",
                "グランドコート",
                "クリアチャーム",
                "くれないのミツ",
                "くろいてっきゅう",
                "くろいヘドロ",
                "くろいメガネ",
                "くろおび",
                "けいけんアメL",
                "けいけんアメM",
                "けいけんアメS",
                "けいけんアメXL",
                "けいけんアメXS",
                "けむりだま",
                "こうかくレンズ",
                "こうこうのしっぽ",
                "こうてつプレート",
                "こおりのいし",
                "こだわりスカーフ",
                "こだわりハチマキ",
                "こだわりメガネ",
                "ゴツゴツメット",
                "こぶしのプレート",
                "こわもてプレート",
                "こんごうだま",
                "サイコシード",
                "さみしがりミント",
                "さらさらいわ",
                "しあわせタマゴ",
                "じしゃく",
                "しずくプレート",
                "しめつけバンド",
                "しめったいわ",
                "じゃくてんほけん",
                "じゅうでんち",
                "しゅんぱつのハネ",
                "しらたま",
                "シルクのスカーフ",
                "しろいハーブ",
                "しんかのきせき",
                "しんちょうミント",
                "しんぴのしずく",
                "すっぱいりんご",
                "スピードパウダー",
                "ずぶといミント",
                "するどいくちばし",
                "するどいツメ",
                "せいしんのハネ",
                "せいれいプレート",
                "せっかちミント",
                "せんせいのツメ",
                "だいこんごうだま",
                "だいしらたま",
                "だいちのプレート",
                "だいはっきんだま",
                "たいようのいし",
                "たいりょくのハネ",
                "タウリン",
                "だっしゅつパック",
                "だっしゅつボタン",
                "たつじんのおび",
                "たべのこし",
                "たまむしプレート",
                "ちからのハチマキ",
                "ちりょくのハネ",
                "つきのいし",
                "つめたいいわ",
                "つららのプレート",
                "ていこうのハネ",
                "テラピースあく",
                "テラピースいわ",
                "テラピースかくとう",
                "テラピースくさ",
                "テラピースゴースト",
                "テラピースこおり",
                "テラピースじめん",
                "テラピースでんき",
                "テラピースどく",
                "テラピースドラゴン",
                "テラピースノーマル",
                "テラピースはがね",
                "テラピースひこう",
                "テラピースフェアリー",
                "テラピースほのお",
                "テラピースみず",
                "テラピースむし",
                "でんきだま",
                "とくせいガード",
                "とくせいカプセル",
                "とくせいパッチ",
                "どくどくだま",
                "どくバリ",
                "とけないこおり",
                "とつげきチョッキ",
                "なまいきミント",
                "なんでもなおし",
                "ねばりのかぎづめ",
                "ねらいのまと",
                "のうてんきミント",
                "ノーマルジュエル",
                "のどスプレー",
                "のろいのおふだ",
                "ノロイノヨロイ",
                "のんきミント",
                "はっきんだま",
                "パワーアンクル",
                "パワーウエイト",
                "パワーバンド",
                "パワーベルト",
                "パワーリスト",
                "パワーレンズ",
                "パワフルハーブ",
                "パンチグローブ",
                "ばんのうがさ",
                "ひかえめミント",
                "ひかりごけ",
                "ひかりのいし",
                "ひかりのこな",
                "ひかりのねんど",
                "ひのたまプレート",
                "ビビリだま",
                "ピントレンズ",
                "ブーストエナジー",
                "ふうせん",
                "フォーカスレンズ",
                "ふしぎなアメ",
                "ふしぎのプレート",
                "ブロムヘキシン",
                "ポイントアップ",
                "ポイントマックス",
                "ぼうごパット",
                "ぼうじんゴーグル",
                "ほのおのいし",
                "まがったスプーン",
                "まじめミント",
                "マックスアップ",
                "まんまるいし",
                "ミストシード",
                "みずのいし",
                "みどりのプレート",
                "むじゃきミント",
                "むらさきのミツ",
                "めざめいし",
                "メタルコート",
                "メタルパウダー",
                "メトロノーム",
                "メンタルハーブ",
                "もうどくプレート",
                "もくたん",
                "ものしりメガネ",
                "もののけプレート",
                "ものまねハーブ",
                "やすらぎのすず",
                "やまぶきのミツ",
                "やみのいし",
                "やわらかいすな",
                "やんちゃミント",
                "ゆうかんミント",
                "ゆきだま",
                "ようきミント",
                "リーフのいし",
                "リゾチウム",
                "りゅうのキバ",
                "りゅうのプレート",
                "ルームサービス",
                "れいせいミント",
                "レッドカード",
                "われたポット",
                "わんぱくミント",
                "ようせいのハネ",
                "みついりりんご",
                "ボンサクのちゃわん",
                "ケッサクのちゃわん",
                "いしずえのめん",
                "いどのめん",
                "かまどのめん",
                "たいりょくのもち",
                "きんりょくのもち",
                "ていこうのもち",
                "ちりょくのもち",
                "せいしんのもち",
                "しゅんぱつのもち",
                "まっさらもち",
                "きれいなウロコ",
                "するどいキバ",
                "れいかいのぬの",
                "あまいミツ",
                "ウルトラボール",
                "クイックボール",
                "ゴージャスボール",
                "コンペボール",
                "サファリボール",
                "スーパーボール",
                "スピードボール",
                "ダークボール",
                "ダイブボール",
                "タイマーボール",
                "ドリームボール",
                "ネストボール",
                "ネットボール",
                "ハイパーボール",
                "ヒールボール",
                "プレミアボール",
                "フレンドボール",
                "ヘビーボール",
                "マスターボール",
                "ムーンボール",
                "モンスターボール",
                "ラブラブボール",
                "リピートボール",
                "ルアーボール",
                "レベルボール",
                "エフェクトガード",
                "クリティカット",
                "スピーダー",
                "スペシャルアップ",
                "スペシャルガード",
                "ディフェンダー",
                "ピッピにんぎょう",
                "プラスパワー",
                "ポケじゃらし",
                "ヨクアタール",
                "アッキのみ",
                "イアのみ",
                "イトケのみ",
                "イバンのみ",
                "ウイのみ",
                "ウタンのみ",
                "ウブのみ",
                "オッカのみ",
                "オボンのみ",
                "オレンのみ",
                "カイスのみ",
                "カゴのみ",
                "カシブのみ",
                "カムラのみ",
                "キーのみ",
                "クラボのみ",
                "ゴスのみ",
                "ザロクのみ",
                "サンのみ",
                "シーヤのみ",
                "ジャポのみ",
                "シュカのみ",
                "ズアのみ",
                "スターのみ",
                "ズリのみ",
                "セシナのみ",
                "ソクノのみ",
                "タポルのみ",
                "タラプのみ",
                "タンガのみ",
                "チーゴのみ",
                "チイラのみ",
                "ドリのみ",
                "ナゾのみ",
                "ナナシのみ",
                "ナナのみ",
                "ナモのみ",
                "ネコブのみ",
                "ノメルのみ",
                "ノワキのみ",
                "パイルのみ",
                "バコウのみ",
                "ハバンのみ",
                "バンジのみ",
                "ビアーのみ",
                "ヒメリのみ",
                "フィラのみ",
                "ブリーのみ",
                "ベリブのみ",
                "ホズのみ",
                "マゴのみ",
                "マトマのみ",
                "ミクルのみ",
                "モコシのみ",
                "モモンのみ",
                "ヤタピのみ",
                "ヤチェのみ",
                "ヨプのみ",
                "ヨロギのみ",
                "ラブタのみ",
                "ラムのみ",
                "リュガのみ",
                "リリバのみ",
                "リンドのみ",
                "レンブのみ",
                "ロゼルのみ",
                "ロメのみ",
                "ねむけざまし",
                "いいキズぐすり",
                "おいしいみず",
                "かいふくのくすり",
                "キズぐすり",
                "げんきのかけら",
                "げんきのかたまり",
                "こおりなおし",
                "サイコソーダ",
                "すごいキズぐすり",
                "ちからのこな",
                "ちからのねっこ",
                "どくけし",
                "ばんのうごな",
                "ピーピーエイダー",
                "ピーピーエイド",
                "ピーピーマックス",
                "ピーピーリカバー",
                "ふっかつそう",
                "まひなおし",
                "まんたんのくすり",
                "ミックスオレ",
                "モーモーミルク",
                "やけどなおし",
                "おおきなキノコ",
                "おおきなしんじゅ",
                "おおきなタケノコ",
                "おだんごしんじゅ",
                "かおるキノコ",
                "きちょうなホネ",
                "きれいなハネ",
                "きんのたま",
                "しんじゅ",
                "すいせいのかけら",
                "ちいさなキノコ",
                "ちいさなタケノコ",
                "でかいきんのたま",
                "ほしのかけら",
                "ほしのすな"
            ];
            var term = request.term.toUpperCase();

            for (i = 0; i < poke_kata.length; i++) {
                var katakanaTerm = hiraganaToKatakana(term);  // 平仮名を片仮名に変換
                var hiraganaTerm = katakanaToHiragana(term);  // 片仮名を平仮名に変換

                // 前方一致
                if (poke_kata[i].indexOf(katakanaTerm) == 0 || poke_kata[i].indexOf(hiraganaTerm) == 0) {
                    list.push(poke_kata[i]);
                }
            }

            list = list.concat(list_bubun);
            list = list.filter(function (x, i, self) { return self.indexOf(x) === i; });
            response(list.slice(0, 4));
        };
    };

    let autoCompleteTargetsPokemon = [$('#item1'), $('#item2'), $('#item3'), $('#item4'), $('#item5'), $('#item6'), $('#tool1'), $('#tool2'), $('#tool3')];
    
    for (let i = 0; i < autoCompleteTargetsPokemon.length; i++) {
        autoCompleteTargetsPokemon[i].autocomplete({
            source: source(),
            autoFocus: true,
            delay: 100,
            select: function (event, ui) {
                // 選択されたときの処理
                var currentInput = $(this);
                var nextInput = currentInput.nextAll('input:first'); // 次のinput要素を取得

                if (nextInput.length > 0) {
                    nextInput.focus();
                } else {
                    // 次の項目がない場合、他の処理を行うか、フォーカスを移動しないようにする
                }
            }
        });
    }
});

// ひらがなをカタカナに変換
function hiraganaToKatakana(src) {
    return src.replace(/[\u3041-\u3096]/g, function (match) {
        var chr = match.charCodeAt(0) + 0x60;
        return String.fromCharCode(chr);
    });
}

// カタカナをひらがなに変換
function katakanaToHiragana(src) {
    return src.replace(/[\u30a1-\u30f6]/g, function (match) {
        var chr = match.charCodeAt(0) - 0x60;
        return String.fromCharCode(chr);
    });
}
